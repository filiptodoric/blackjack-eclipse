<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Blackjack</title>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="../blackjack/deck.js"></script>
<script src="../blackjack/game.js"></script>
<script>


	
	var index = -1;
	var deck = getDeck();

	//  for scoring
	var num = -1;

	
	var player1_hand = new Array();
	var player2_hand = new Array();
	var player3_hand = new Array();
	var dealer_hand = new Array();
	
	var player1_stand = true;
	var player2_stand = true;
	var player3_stand = true;
	
	function deal() {
		index++
		return deck[index];
	}

	function change() {
		var card = deal();
		index++;
		$("#dealer-cards").html(card);
	}

/* 	var player1_hand = new Array();
	player1_hand[0] = deal();
	player1_hand[1] = deal();

	
	//Dealer hand
	var dealer_hand = new Array();
	dealer_hand[0] = deal();
	dealer_hand[1] = deal(); */
	
	function hit(hand, element) {
		hand[hand.length] = deal();
		display(hand, element)
	}

	function score(hand) {
		var total = 0;
		var soft = 0;
		var value = 0; 
		for (i = 0; i < hand.length; i++) {
			value = hand[i];
			if (value == 1) {
				soft = soft + 1;
				total = total + 11;
			} 
			else {
				if (value == 11 || value == 12 || value == 13) {
					total = total + 10;
				} 
				else {
					total = total + value;
				}
			}
		}
		while (soft > 0 && total > 21) {
			total = total - 10; 
			soft = soft - 1;
		}
		return total;
	}

	function dealer(dealer_hand) {
		var hasAce = false;
		for (i = 0; i < dealer_hand.length; i++) {
			value = dealer_hand[i];
			if (value == 1) {
				hasAce = true;
			} 
		}
		if (score(dealer_hand) < 17) {
			hit(dealer_hand, "dealer_hand");
		}
		if(score(dealer_hand) == 17 && hasAce == true)	{
			hit(dealer_hand, "dealer_hand");
		}
		return score(dealer_hand);
	}
	
	
	
	function display(hand, element)	{
		var str = "";
		for(var x = 0; x < hand.length; x++)	{
			
			if(hand[x] == 11)	{
				str += "Jack ";
			}
			if(hand[x] == 12)	{
				str += "Queen ";
			}
			if(hand[x] == 13)	{
				str += "King ";
			}
			if(hand[x] == 1)	{
				str += "Ace ";
			}
			if(hand[x] != 11 && hand[x] != 12 && hand[x] != 13 && hand[x] != 1)	{
				str += hand[x] + " ";
			}
			if(score(hand) > 21)	{
				str = "BUSTED";
			}
			if(hand.length == 7 && score(hand) <= 21)	{
				str = "Winner, 7-card charlie";
				//need to disable other players because winner is found
			}
		}
		$("#" + element).html(str);
	}
	
	function start()	{
		while(num < 1 || num > 3)	{
			num = prompt("Please enter the number of players.");
		}
		if(num == 2)	{
			$("#player2").show();	
			player2_hand[0] = deal();
			player2_hand[1] = deal();
			display(player2_hand, "player2_hand");
			var player2_stand = false;
		}
		if(num == 3)	{
			$("#player2").show();
			$("#player3").show();
			player2_hand[0] = deal();
			player2_hand[1] = deal();
			player3_hand[0] = deal();
			player3_hand[1] = deal();
			display(player2_hand, "player2_hand");
			display(player3_hand, "player3_hand");
			var player2_stand = false;
			var player3_stand = false;
		}
		player1_hand[0] = deal();
		player1_hand[1] = deal();
		dealer_hand[0] = deal();
		dealer_hand[1] = deal();
		var player1_stand = false;
		display(player1_hand, "player1_hand");
	    display(dealer_hand, "dealer_hand");
	}
	
	function stand(player)	{
		player = true;
	}
	
	function checkWinner()	{
		var scores = new Array();	
		if(player1_stand == true && player2_stand == true && player3_stand == true)	{
			if(num == 1)	{
				scores[0] = score(player1_hand);
			}
			if(num == 2)	{
				scores[0] = score(player1_hand);
				scores[1] = score(player2_hand);
			}
			if(num == 3)	{
				scores[0] = score(player1_hand);
				scores[1] = score(player2_hand);
				scores[2] = score(player3_hand);
			}
		}
		for(var x = 0; x < num ; x++)	{
			// if dealer busts and you're under 21
			if(score(dealer_hand) > 21 && scores[x] <= 21)	{
				var playerNum = x + 1;
				var playerDiv = "player" + playerNum + "_hand";
				$("#" + playerDiv).html("Winner");
				$("#dealer_hand").html("Dealer busts.");
				console.dir(playerDiv);
			}
		}
		
	}
	
	
</script>
<body>
<h1>Blackjack</h1>
  <button onclick="start()">Start game!</button>
  <hr><hr>
  <div id="dealer">
  <button onclick="dealer(dealer_hand)">Dealer</button>
  	<h3>Dealer Cards:</h3>
  	<div id="dealer_hand"></div>
  </div>
  <hr>
  <div id="player1">
  	<h3>Player 1 Cards:</h3>
  	<div id="player1_hand"></div>
  	<button onclick="hit(player1_hand, 'player1_hand')">Hit</button>
  	<button onclick="stand(player1_stand)">Stand</button>
  </div>
  <hr>
  <div id="player2" style="display: none">
  	<h3>Player 2 Cards:</h3>
  	<div id="player2_hand"></div>
  	<button onclick="hit(player2_hand, 'player2_hand')">Hit</button>
  	<button onclick="stand(player2_stand)">Stand</button>
  </div>
    <hr>
  <div id="player3" style="display: none">
  	<h3>Player 3 Cards:</h3>
  	<div id="player3_hand"></div>
  	<button onclick="hit(player3_hand, 'player3_hand')">Hit</button>
  	<button onclick="stand(player3_stand)">Stand</button>
  </div>
</body>
</html>